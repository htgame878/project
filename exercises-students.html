<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/exercises.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="main-content">
        <div class="container-narrow">
            
            <div class="page-header-simple">
                <a href="exercises-landing.html" class="back-btn"><i class="fa-solid fa-arrow-right"></i></a>
                <h1>ØªÙ…Ø±ÛŒÙ† Ù‡Ø§ÛŒ Ø§Ù†ÙØ±Ø§Ø¯ÛŒ Ø´Ø®ØµÛŒ Ø³Ø§Ø²ÛŒ Ø´Ø¯Ù‡</h1>
            </div>
            <br/>
            <br/>
            <div class="filter-bar">
                <span style="font-size:0.9rem; color:#64748b"><i class="fa-solid fa-filter"></i> Ù…Ø±ØªØ¨ Ø³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³:</span>
                <select id="sortSelect" class="sort-select">
                    <option value="ai_priority">âš¡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</option>
                    <option value="alphabetical">ğŸ”¤ Ø­Ø±ÙˆÙ Ø§Ù„ÙØ¨Ø§</option>
                </select>
            </div>

            <div id="studentsList" class="students-list-stack">
                </div>

        </div>
        
    </div>
    <div id="generatorModal" class="modal-overlay">
        <div class="modal-box">
            
            <div class="modal-header">
                <div class="header-top">
                    <h2 style="margin:0; font-size:1.2em;">Ø³Ø§Ø®Øª ØªÙ…Ø±ÛŒÙ† Ù‡ÙˆØ´Ù…Ù†Ø¯</h2>
                    <button class="close-btn" onclick="closeGeneratorModal()">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>

                <div class="input-group">
                    <input type="text" id="topicInput" placeholder="Ù…ÙˆØ¶ÙˆØ¹ ØªÙ…Ø±ÛŒÙ† (Ù…Ø«Ù„Ø§Ù‹: Ù…Ø´ØªÙ‚)">
                    <select id="difficultySelect">
                        <option value="easy">Ø¢Ø³Ø§Ù†</option>
                        <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
                        <option value="hard">Ø³Ø®Øª</option>
                    </select>
                    <button class="btn-generate" onclick="generateExercise()">
                        <i class="fa-solid fa-wand-magic-sparkles"></i>
                        Ø³Ø§Ø®Øª
                    </button>
                </div>
            </div>

            <div class="modal-body">
                <div class="exercises-stream" id="streamContainer">
                    </div>
            </div>

        </div>
    </div>
    <script>
        // --- Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¯Ø§Ù„ ---
        const modal = document.getElementById('generatorModal');

        function openGeneratorModal() {
            modal.classList.add('open');
        }

        function closeGeneratorModal() {
            modal.classList.remove('open');
        }

        // Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ ÙØ¶Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ø§Ø·Ø±Ø§Ù
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeGeneratorModal();
            }
        });


        // --- Ù…Ù†Ø·Ù‚ ØªÙˆÙ„ÛŒØ¯ ØªÙ…Ø±ÛŒÙ† (Ø§Ø² Ú©Ø¯ Ù‚Ø¨Ù„ÛŒ Ø´Ù…Ø§) ---
        let exerciseCount = 0;

        function generateExercise() {
            const container = document.getElementById('streamContainer');
            const topic = document.getElementById('topicInput').value || 'Ø±ÛŒØ§Ø¶ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ';
            const difficulty = document.getElementById('difficultySelect').value;

            // Ø³Ø§Ø®Øª Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø§Ø³Ú©Ù„ØªÙˆÙ†
            const skeletonWrapper = document.createElement('div');
            skeletonWrapper.innerHTML = `
                <div class="skeleton-card">
                    <div class="skeleton s-header"></div>
                    <div class="skeleton s-line"></div>
                    <div class="skeleton s-line"></div>
                    <div class="skeleton s-line-short"></div>
                    <div class="skeleton s-footer"></div>
                </div>
            `;
            container.prepend(skeletonWrapper);

            // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ Ø¨Ø§Ù„Ø§ Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù† Ù„ÙˆØ¯ÛŒÙ†Ú¯
            container.scrollTop = 0;

            setTimeout(() => {
                skeletonWrapper.remove();
                exerciseCount++;

                let badgeClass = '';
                let badgeText = '';
                if(difficulty === 'easy') { badgeClass = 'badge-easy'; badgeText = 'Ø¢Ø³Ø§Ù†'; }
                else if(difficulty === 'medium') { badgeClass = 'badge-medium'; badgeText = 'Ù…ØªÙˆØ³Ø·'; }
                else { badgeClass = 'badge-hard'; badgeText = 'Ø³Ø®Øª'; }

                const cardData = {
                    title: `ØªÙ…Ø±ÛŒÙ† Ø³Ø±ÛŒ ${exerciseCount}: ${topic}`,
                    body: `Ø§ÛŒÙ† ÛŒÚ© ØªÙ…Ø±ÛŒÙ† ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ø¨Ø­Ø« <strong>${topic}</strong> Ø§Ø³Øª...`,
                    badgeClass: badgeClass,
                    badgeText: badgeText
                };

                const cardHTML = `
                    <div class="exercise-card">
                        <div class="card-header">
                            <span class="card-title">${cardData.title}</span>
                            <span class="badge ${cardData.badgeClass}">${cardData.badgeText}</span>
                        </div>
                        <div class="card-body">
                            <p>${cardData.body}</p>
                        </div>
                        <div class="card-footer">
                            <button class="action-btn btn-delete"><i class="fa-solid fa-trash"></i> Ø­Ø°Ù</button>
                            <button class="action-btn"><i class="fa-solid fa-pen"></i> ÙˆÛŒØ±Ø§ÛŒØ´</button>
                            <button class="action-btn btn-add"><i class="fa-solid fa-plus"></i> Ø§ÙØ²ÙˆØ¯Ù†</button>
                        </div>
                    </div>
                `;

                const cardWrapper = document.createElement('div');
                cardWrapper.innerHTML = cardHTML;
                container.prepend(cardWrapper.firstElementChild);

            }, 2000);
        }
    </script>
    <script src="js/layout.js"></script>
    <script type="module" src="js/exercises.js"></script>
</body>
</html>