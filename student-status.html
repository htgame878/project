<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/student-status.css">
    <title>Document</title>
  </head>
  <body>
    <div class="dashboard-list main-content">
      <div class="student-card">
        <div class="student-info">
          <img
            src="https://via.placeholder.com/50"
            alt="Avatar"
            class="avatar"
          />
          <div>
            <h3 class="student-name">ุนู ุฑุถุง</h3>
            <span class="father-name">ูุงู ูพุฏุฑ: ูุญูุฏ</span>
          </div>
        </div>
        <div class="status-badge status-safe">
          <span class="icon">โ</span>
          ุฑููุฏ ูุซุจุช
        </div>
      </div>

      <div class="student-card">
        <div class="student-info">
          <img
            src="https://via.placeholder.com/50"
            alt="Avatar"
            class="avatar"
          />
          <div>
            <h3 class="student-name">ุญุณู ฺฉูุงู</h3>
            <span class="father-name">ูุงู ูพุฏุฑ: ุฑุถุง</span>
          </div>
        </div>

        <button
          class="status-badge status-critical open-modal-btn"
          data-name="ุญุณู ฺฉูุงู"
          data-risk="70"
          data-analysis="ุฑููุฏ ูุฒูู ููุฑุงุช ุฏุฑ ณ ููุชู ุงุฎุฑ ูุดุงูุฏู ุดุฏู ุงุณุช. ุนุฏู ุชุญูู ุชูุงุฑู ุฑุงุถ ุชุงุซุฑ ููู ุฏุงุดุชู ุงุณุช."
        >
          <div class="status-content">
            <span class="status-title">ูุงุฒ ุจู ุจุฑุฑุณ</span>
            <span class="status-sub">ุฏุฑ ูุนุฑุถ ุฎุทุฑ</span>
          </div>
          <span class="icon-bell">๐</span>
        </button>
      </div>

      <div class="student-card">
        <div class="student-info">
          <img
            src="https://via.placeholder.com/50"
            alt="Avatar"
            class="avatar"
          />
          <div>
            <h3 class="student-name">ุณุงุฑุง ุงุญูุฏ</h3>
            <span class="father-name">ูุงู ูพุฏุฑ: ุนู</span>
          </div>
        </div>
        <div class="status-badge status-safe">
          <span class="icon">โ</span>
          ุฑููุฏ ูุซุจุช
        </div>
      </div>
    </div>

    <div id="analysisModal" class="modal-overlay">
      <div class="modal-box">
        <div class="modal-header">
          <h3 id="modalTitle">ุชุญูู ููุดููุฏ</h3>
          <span class="close-btn">&times;</span>
        </div>

        <div class="modal-body">
          <div class="analysis-box">
            <p id="modalText">ูุชู ุชุญูู ุงูุฌุง ูุฑุงุฑ ูโฺฏุฑุฏ...</p>
          </div>

          <div class="risk-section">
            <span>ุงุญุชูุงู ุงูุช ุชุญุตู:</span>
            <span id="modalRiskValue" class="risk-value">0%</span>
          </div>
        </div>

        <div class="modal-footer">
          <button id="actionBtn" class="primary-btn">
            <span class="btn-text">ุชููุฏ ุจุฑูุงูู ฺฉูฺฉ ููุดููุฏ</span>
            <span class="btn-spinner">โ</span>
          </button>
        </div>
      </div>
    </div>
  </body>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // ฺฏุฑูุชู ุงููุงูโูุง
      const modal = document.getElementById("analysisModal");
      const closeBtn = document.querySelector(".close-btn");
      const actionBtn = document.getElementById("actionBtn");
      const openBtns = document.querySelectorAll(".open-modal-btn");

      // ุงููุงูโูุง ุฏุงุฎู ููุฏุงู ุจุฑุง ูพุฑ ฺฉุฑุฏู ูุญุชูุง
      const modalTitle = document.getElementById("modalTitle");
      const modalText = document.getElementById("modalText");
      const modalRisk = document.getElementById("modalRiskValue");
      const btnText = actionBtn.querySelector(".btn-text");
      const btnSpinner = actionBtn.querySelector(".btn-spinner");

      // 1. ุจุงุฒ ฺฉุฑุฏู ููุฏุงู ู ูพุฑ ฺฉุฑุฏู ุงุทูุงุนุงุช
      openBtns.forEach((btn) => {
        btn.addEventListener("click", function () {
          // ุฎูุงูุฏู ุฏุชุง ุงุฒ ูฺฺฏโูุง data-* ุฏฺฉูู ฺฉูฺฉ ุดุฏู
          const name = this.getAttribute("data-name");
          const risk = this.getAttribute("data-risk");
          const analysis = this.getAttribute("data-analysis");

          // ุชุฒุฑู ุจู ููุฏุงู
          modalTitle.textContent = `ุชุญูู ูุถุนุช ${name}`;
          modalText.textContent = analysis;
          modalRisk.textContent = `${risk}%`;

          // ููุงุด ููุฏุงู
          modal.classList.add("active");

          // ุฑุณุช ฺฉุฑุฏู ุฏฺฉูู ุจู ุญุงูุช ุงููู (ุงฺฏุฑ ูุจูุง ุณุจุฒ ุดุฏู ุจูุฏ)
          resetButton();
        });
      });

      // 2. ุจุณุชู ููุฏุงู
      closeBtn.addEventListener("click", () => {
        modal.classList.remove("active");
      });

      // ุจุณุชู ุจุง ฺฉูฺฉ ุฑู ูุถุง ุฎุงู (Overlay)
      modal.addEventListener("click", (e) => {
        if (e.target === modal) {
          modal.classList.remove("active");
        }
      });

      // 3. ูุฏุฑุช ุฏฺฉูู ุงฺฉุดู (ุดุจูโุณุงุฒ ุฏุฑุฎูุงุณุช ุณุฑูุฑ)
      actionBtn.addEventListener("click", function () {
        // ุงฺฏุฑ ุฏฺฉูู ูุจูุง ุฒุฏู ุดุฏู ุง ุฏุฑ ุญุงู ููุฏ ุงุณุชุ ฺฉุงุฑ ูฺฉู
        if (this.disabled) return;

        // --- ุญุงูุช Loading ---
        this.disabled = true; // ุบุฑูุนุงู ฺฉุฑุฏู ุฏฺฉูู
        this.style.backgroundColor = "#90CAF9"; // ุฑูฺฏ ุบุฑูุนุงู
        btnText.textContent = "ุฏุฑ ุญุงู ุณุงุฎุช ุจุฑูุงูู...";
        btnSpinner.style.display = "block"; // ููุงุด ุงุณูพูุฑ

        // ุดุจูโุณุงุฒ ุชุงุฎุฑ 2 ุซุงููโุง (ูุซู ุฏุฑุฎูุงุณุช ุจู ุณุฑูุฑ)
        setTimeout(() => {
          // --- ุญุงูุช Success ---
          this.style.backgroundColor = "#4CAF50"; // ุณุจุฒ ููููุช
          btnText.textContent = "ุจุฑูุงูู ุจุง ููููุช ุซุจุช ุดุฏ";
          btnSpinner.style.display = "none";

          // ุจุณุชู ุฎูุฏฺฉุงุฑ ููุฏุงู ุจุนุฏ ุงุฒ 1.5 ุซุงูู
          setTimeout(() => {
            modal.classList.remove("active");
            resetButton(); // ุจุฑฺฏุฑุฏุงูุฏู ุฏฺฉูู ุจู ุญุงูุช ุงูู
          }, 1500);
        }, 2000);
      });

      // ุชุงุจุน ฺฉูฺฉ ุจุฑุง ุฑุณุช ฺฉุฑุฏู ุฏฺฉูู
      function resetButton() {
        actionBtn.disabled = false;
        actionBtn.style.backgroundColor = "#1976D2";
        btnText.textContent = "ุชููุฏ ุจุฑูุงูู ฺฉูฺฉ ููุดููุฏ";
        btnSpinner.style.display = "none";
      }
    });
  </script>
  <script src="js/layout.js"></script>
</html>
